<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Remote Control</title>
    <style>
        body, html {
            margin: 0;
            padding: 0;
            overflow: hidden;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: black;
        }

        video {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }
    </style>
</head>
<body>
<video id="video" autoplay playsinline></video>

<script>
    const video = document.getElementById('video');

    async function initializeCamera() {
        try {
            const constraints = {
                video: {
                    width: { ideal: 1920 },
                    height: { ideal: 1080 }
                }
            };

            const stream = await navigator.mediaDevices.getUserMedia(constraints);
            video.srcObject = stream;

            video.addEventListener('loadedmetadata', () => {
                console.log(`Camera resolution: ${video.videoWidth}x${video.videoHeight}`);
            });
        } catch (error) {
            console.error('Error accessing the camera:', error);
        }
    }

    initializeCamera();

    function getEventCoordinates(event) {
        const rect = video.getBoundingClientRect();
        const scaleX = video.videoWidth / rect.width;
        const scaleY = video.videoHeight / rect.height;

        return {
            x: Math.round((event.clientX - rect.left) * scaleX),
            y: Math.round((event.clientY - rect.top) * scaleY)
        };
    }

    function sendEventData(endpoint, params = {}) {
        const url = `${window.location.origin}/api/${endpoint}?${new URLSearchParams(params)}`;
        fetch(url, { method: 'POST' });
    }

    video.addEventListener('mousemove', (event) => {
        const {x, y} = getEventCoordinates(event);
        sendEventData('mousemove', {x, y});
    });

    video.addEventListener('mousedown', (event) => {
        const buttonMap = {0: 'left', 1: 'middle', 2: 'right'};
        sendEventData('mousedown', {button: buttonMap[event.button]});
    });

    video.addEventListener('mouseup', () => {
        sendEventData('mouseup');
    });

    document.addEventListener('keydown', (event) => {
        const key = event.key.length === 1 ? event.key : event.key.toLowerCase();
        sendEventData('keydown', {
            key,
            control: event.ctrlKey,
            shift: event.shiftKey,
            alt: event.altKey
        });
    });

    document.addEventListener('keyup', () => {
        sendEventData('keyup');
    });

    ['dblclick', 'wheel', 'contextmenu', 'beforeunload'].forEach(type => {
        window.addEventListener(type, e => {
            e.preventDefault();
            if (type === 'beforeunload') return '';
        });
    });
</script>
</body>
</html>

